<% present_others = players.reject { |u| u.id == self_id } %>
<% if present_others.empty? %>
  <p>Aucun autre joueur présent dans le lobby.</p>
<% else %>
  <div class="list-group m-4">
    <% present_others.each do |player| %>
      <% busy_game = PazaakGame.where(status: PazaakGame.statuses[:in_progress]).where("host_id = ? OR guest_id = ?", player.id, player.id).order(created_at: :desc).first %>
      <% busy = busy_game.present? %>
      <div class="list-group-item d-flex justify-content-between align-items-center w-50">
        <span>
          <%= player.username || player.email %>
          <% if busy %>
            <span class="badge bg-warning text-dark ms-2">occupé</span>
          <% end %>
        </span>
        <% if busy && (self_id == player.id || self_id == busy_game&.host_id || self_id == busy_game&.guest_id) %>
          <%= link_to "Reprendre votre partie", pazaak_game_path(busy_game), class: "btn btn-sm btn-outline-light" %>
        <% elsif !busy %>
          <%= form_with url: pazaak_invitations_path, method: :post, class: 'd-flex align-items-center gap-2' do %>
            <%= hidden_field_tag :invitee_id, player.id %>
            <%= number_field_tag :stake, 0, min: 0, step: 10, class: 'form-control form-control-sm', style: 'width:100px', placeholder: 'Mise' %>
            <%= submit_tag "Inviter", class: "btn btn-sm btn-primary" %>
          <% end %>
        <% end %>
      </div>
    <% end %>
  </div>
<% end %>


