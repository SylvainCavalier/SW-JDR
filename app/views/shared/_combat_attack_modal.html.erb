<!-- Modal d'attaque pour les PJ -->
<div class="modal fade" id="combatAttackModal" tabindex="-1" aria-labelledby="combatAttackModalLabel" aria-hidden="true"
     data-controller="combat-attack">
  <div class="modal-dialog modal-lg">
    <div class="modal-content bg-dark text-white">
      <div class="modal-header">
        <h5 class="modal-title" id="combatAttackModalLabel">
          Attaque : <span data-combat-attack-target="targetName">—</span>
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="row">
          <!-- Section Précision -->
          <div class="col-md-6">
            <h6 class="text-success mb-3">Précision</h6>

            <div class="mb-2">
              <label class="form-label">Compétence</label>
              <select class="form-select form-select-sm"
                      data-combat-attack-target="skillSelect"
                      data-action="change->combat-attack#skillChanged">
                <option value="" disabled selected>— Choisir —</option>
                <% combat_skills = ["Tir", "Lancer", "Armes Blanches", "Arts Martiaux", "Sabre-Laser"] %>
                <% combat_skills.each do |skill_name| %>
                  <% us = current_user.user_skills.joins(:skill).find_by(skills: { name: skill_name }) %>
                  <option data-mastery="<%= us&.mastery || 0 %>" data-bonus="<%= us&.bonus || 0 %>">
                    <%= skill_name %> (<%= us&.mastery || 0 %>D+<%= us&.bonus || 0 %>)
                  </option>
                <% end %>
              </select>
            </div>

            <div class="d-flex align-items-center gap-2 mb-2">
              <div>
                <label class="form-label mb-0">Dés</label>
                <input type="number" class="form-control form-control-sm" style="width: 70px;" min="0" max="20" value="0"
                       data-combat-attack-target="precisionDice">
              </div>
              <span class="mt-3">D6 +</span>
              <div>
                <label class="form-label mb-0">Bonus</label>
                <input type="number" class="form-control form-control-sm" style="width: 70px;" min="0" value="0"
                       data-combat-attack-target="precisionBonus">
              </div>
            </div>

            <div class="d-flex align-items-center gap-1">
              <label class="form-label">Résultat</label>
              <input type="text" class="form-control form-control-sm dice-result" readonly
                     data-combat-attack-target="precisionResult">
            </div>
            <div class="dice-details bg-white rounded mb-3" data-combat-attack-target="precisionDetails"></div>
          </div>

          <!-- Section Dégâts -->
          <div class="col-md-6">
            <h6 class="text-danger mb-3">Dégâts</h6>

            <div class="mb-2">
              <label class="form-label">Arme</label>
              <select class="form-select form-select-sm"
                      data-combat-attack-target="weaponSelect"
                      data-action="change->combat-attack#weaponChanged">
                <option value="" disabled selected>— Choisir —</option>
                <% weapon_slots = ["Arme Principale", "Arme Secondaire", "Explosifs"] %>
                <% current_user.equipments.where(equipped: true, slot: weapon_slots).each do |eq| %>
                  <option data-mastery="<%= eq.mastery %>" data-bonus="<%= eq.bonus %>">
                    <%= eq.name %> (<%= eq.mastery %>D+<%= eq.bonus %>)
                  </option>
                <% end %>
              </select>
            </div>

            <div class="d-flex align-items-center gap-2 mb-2">
              <div>
                <label class="form-label mb-0">Dés</label>
                <input type="number" class="form-control form-control-sm" style="width: 70px;" min="0" max="20" value="0"
                       data-combat-attack-target="damageDice">
              </div>
              <span class="mt-3">D6 +</span>
              <div>
                <label class="form-label mb-0">Bonus</label>
                <input type="number" class="form-control form-control-sm" style="width: 70px;" min="0" value="0"
                       data-combat-attack-target="damageBonus">
              </div>
            </div>

            <div class="d-flex align-items-center gap-1">
              <label class="form-label">Résultat</label>
              <input type="text" class="form-control form-control-sm dice-result" readonly
                     data-combat-attack-target="damageResult">
            </div>
            <div class="dice-details bg-white rounded mb-3" data-combat-attack-target="damageDetails"></div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Fermer</button>
        <button type="button" class="btn btn-outline-success" data-action="click->combat-attack#roll">
          <i class="fa-solid fa-dice"></i> Lancer
        </button>
      </div>
    </div>
  </div>
</div>
