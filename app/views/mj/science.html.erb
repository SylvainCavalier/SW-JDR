<div class="container mt-4">
  <h1 class="text-center text-primary mb-4">üî¨ Gestion Science - MJ</h1>

  <!-- Stats rapides -->
  <div class="row mb-4">
    <div class="col-md-4">
      <div class="card bg-dark text-light border-info">
        <div class="card-body text-center">
          <h3 class="text-info"><%= @all_gestations.count %></h3>
          <p class="mb-0">Embryons en gestation</p>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card bg-dark text-light border-success">
        <div class="card-body text-center">
          <h3 class="text-success"><%= @ready_embryos.count %></h3>
          <p class="mb-0">Cr√©atures pr√™tes √† na√Ætre</p>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card bg-dark text-light border-warning">
        <div class="card-body text-center">
          <h3 class="text-warning"><%= @bio_savants.count %></h3>
          <p class="mb-0">Bio-savants actifs</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Embryons en gestation -->
  <div class="card bg-dark text-light border-primary mb-4">
    <div class="card-header bg-primary text-white">
      <h5 class="mb-0"><i class="fa-solid fa-egg me-2"></i>Embryons en gestation</h5>
    </div>
    <div class="card-body">
      <% if @all_gestations.any? %>
        <div class="table-responsive">
          <table class="table table-dark table-hover">
            <thead>
              <tr>
                <th>Bio-savant</th>
                <th>Embryon</th>
                <th>Type</th>
                <th>Cuve</th>
                <th>Jours restants</th>
                <th>Progression</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <% @all_gestations.each do |embryo| %>
                <tr>
                  <td><%= embryo.user.username %></td>
                  <td><strong><%= embryo.name %></strong></td>
                  <td><span class="badge bg-success"><%= embryo.creature_type.humanize %></span></td>
                  <td><span class="badge bg-info">Cuve <%= embryo.gestation_tube %></span></td>
                  <td>
                    <span class="badge bg-<%= embryo.gestation_days_remaining <= 3 ? 'warning' : 'secondary' %>">
                      <%= embryo.gestation_days_remaining %> / <%= embryo.gestation_days_total %> jours
                    </span>
                  </td>
                  <td style="width: 150px;">
                    <% progress = embryo.gestation_days_total > 0 ? ((embryo.gestation_days_total - embryo.gestation_days_remaining).to_f / embryo.gestation_days_total * 100).round : 0 %>
                    <div class="progress" style="height: 20px;">
                      <div class="progress-bar bg-success" style="width: <%= progress %>%;"><%= progress %>%</div>
                    </div>
                  </td>
                  <td>
                    <div class="btn-group btn-group-sm">
                      <%= button_to "+1 jour", mj_advance_gestation_path(embryo_id: embryo.id, days: 1), 
                          method: :post, class: "btn btn-outline-info btn-sm" %>
                      <%= button_to "+5 jours", mj_advance_gestation_path(embryo_id: embryo.id, days: 5), 
                          method: :post, class: "btn btn-outline-warning btn-sm" %>
                      <%= button_to "Terminer", mj_complete_gestation_path(embryo_id: embryo.id), 
                          method: :post, class: "btn btn-outline-success btn-sm",
                          data: { confirm: "Terminer la gestation de #{embryo.name} ?" } %>
                    </div>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      <% else %>
        <p class="text-muted text-center py-4">Aucun embryon en gestation.</p>
      <% end %>
    </div>
  </div>

  <!-- Cr√©atures pr√™tes -->
  <% if @ready_embryos.any? %>
    <div class="card bg-dark text-light border-success mb-4">
      <div class="card-header bg-success text-white">
        <h5 class="mb-0"><i class="fa-solid fa-paw me-2"></i>Cr√©atures pr√™tes √† na√Ætre</h5>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-dark table-hover">
            <thead>
              <tr>
                <th>Bio-savant</th>
                <th>Cr√©ature</th>
                <th>Type</th>
                <th>PV</th>
                <th>D√©g√¢ts</th>
              </tr>
            </thead>
            <tbody>
              <% @ready_embryos.each do |embryo| %>
                <tr>
                  <td><%= embryo.user.username %></td>
                  <td><strong><%= embryo.name %></strong></td>
                  <td><span class="badge bg-success"><%= embryo.creature_type.humanize %></span></td>
                  <td><%= embryo.hp_max %></td>
                  <td><%= embryo.damage_1 %>D+<%= embryo.damage_bonus_1 %></td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  <% end %>

  <!-- Bio-savants -->
  <div class="card bg-dark text-light border-warning">
    <div class="card-header bg-warning text-dark">
      <h5 class="mb-0"><i class="fa-solid fa-user-doctor me-2"></i>Bio-savants</h5>
    </div>
    <div class="card-body">
      <% if @bio_savants.any? %>
        <div class="row">
          <% @bio_savants.each do |user| %>
            <div class="col-md-4 mb-3">
              <div class="card bg-secondary">
                <div class="card-body">
                  <h6 class="card-title"><%= user.username %></h6>
                  <p class="card-text small mb-1">
                    <i class="fa-solid fa-flask text-info me-1"></i>
                    Embryons: <%= user.embryos.count %>
                  </p>
                  <p class="card-text small mb-1">
                    <i class="fa-solid fa-egg text-primary me-1"></i>
                    En gestation: <%= user.embryos.in_gestation.count %>
                  </p>
                  <p class="card-text small mb-0">
                    <i class="fa-solid fa-graduation-cap text-warning me-1"></i>
                    Points d'√©tude: <%= user.study_points %>
                  </p>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <p class="text-muted text-center py-4">Aucun Bio-savant dans le jeu.</p>
      <% end %>
    </div>
  </div>

  <!-- Lien retour -->
  <div class="text-center mt-4">
    <%= link_to mj_dashboard_path, class: "btn btn-outline-secondary" do %>
      <i class="fa-solid fa-arrow-left me-2"></i>Retour au Dashboard MJ
    <% end %>
  </div>
</div>

