<div class="container mt-4">
  <h1 class="text-center text-primary mb-4">üî¨ Gestion Science - MJ</h1>

  <!-- Stats rapides -->
  <div class="row mb-4">
    <div class="col-md-4">
      <div class="card bg-dark text-light border-info">
        <div class="card-body text-center">
          <h3 class="text-info"><%= @all_gestations.count %></h3>
          <p class="mb-0">Embryons en gestation</p>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card bg-dark text-light border-success">
        <div class="card-body text-center">
          <h3 class="text-success"><%= @ready_embryos.count %></h3>
          <p class="mb-0">Cr√©atures pr√™tes √† na√Ætre</p>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card bg-dark text-light border-warning">
        <div class="card-body text-center">
          <h3 class="text-warning"><%= @bio_savants.count %></h3>
          <p class="mb-0">Bio-savants actifs</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Embryons en gestation -->
  <div class="card bg-dark text-light border-primary mb-4">
    <div class="card-header bg-primary text-white">
      <h5 class="mb-0"><i class="fa-solid fa-egg me-2"></i>Embryons en gestation</h5>
    </div>
    <div class="card-body">
      <% if @all_gestations.any? %>
        <div class="table-responsive">
          <table class="table table-dark table-hover">
            <thead>
              <tr>
                <th>Bio-savant</th>
                <th>Embryon</th>
                <th>Type</th>
                <th>Cuve</th>
                <th>Jours restants</th>
                <th>Progression</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <% @all_gestations.each do |embryo| %>
                <tr>
                  <td><%= embryo.user&.username || 'Inconnu' %></td>
                  <td><strong><%= embryo.name %></strong></td>
                  <td><span class="badge bg-success"><%= embryo.creature_type&.humanize || 'N/A' %></span></td>
                  <td><span class="badge bg-info">Cuve <%= embryo.gestation_tube || '?' %></span></td>
                  <td>
                    <% days_remaining = embryo.gestation_days_remaining || 0 %>
                    <% days_total = embryo.gestation_days_total || 1 %>
                    <span class="badge bg-<%= days_remaining <= 3 ? 'warning' : 'secondary' %>">
                      <%= days_remaining %> / <%= days_total %> jours
                    </span>
                  </td>
                  <td style="width: 150px;">
                    <% progress = days_total > 0 ? ((days_total - days_remaining).to_f / days_total * 100).round : 0 %>
                    <div class="progress" style="height: 20px;">
                      <div class="progress-bar bg-success" style="width: <%= progress %>%;"><%= progress %>%</div>
                    </div>
                  </td>
                  <td>
                    <div class="btn-group btn-group-sm">
                      <%= button_to "+1 jour", mj_advance_gestation_path(embryo_id: embryo.id, days: 1), 
                          method: :post, class: "btn btn-outline-info btn-sm" %>
                      <%= button_to "+5 jours", mj_advance_gestation_path(embryo_id: embryo.id, days: 5), 
                          method: :post, class: "btn btn-outline-warning btn-sm" %>
                      <%= button_to "Terminer", mj_complete_gestation_path(embryo_id: embryo.id), 
                          method: :post, class: "btn btn-outline-success btn-sm",
                          data: { confirm: "Terminer la gestation de #{embryo.name} ?" } %>
                    </div>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      <% else %>
        <p class="text-muted text-center py-4">Aucun embryon en gestation.</p>
      <% end %>
    </div>
  </div>

  <!-- Cr√©atures pr√™tes -->
  <% if @ready_embryos.any? %>
    <div class="card bg-dark text-light border-success mb-4">
      <div class="card-header bg-success text-white">
        <h5 class="mb-0"><i class="fa-solid fa-paw me-2"></i>Cr√©atures pr√™tes √† na√Ætre</h5>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-dark table-hover">
            <thead>
              <tr>
                <th>Bio-savant</th>
                <th>Cr√©ature</th>
                <th>Type</th>
                <th>PV</th>
                <th>D√©g√¢ts</th>
              </tr>
            </thead>
            <tbody>
              <% @ready_embryos.each do |embryo| %>
                <tr>
                  <td><%= embryo.user&.username || 'Inconnu' %></td>
                  <td><strong><%= embryo.name %></strong></td>
                  <td><span class="badge bg-success"><%= embryo.creature_type&.humanize || 'N/A' %></span></td>
                  <td><%= embryo.hp_max || 0 %></td>
                  <td><%= embryo.damage_1 || 0 %>D+<%= embryo.damage_bonus_1 || 0 %></td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  <% end %>

  <!-- Bio-savants et Points d'√©tude -->
  <div class="card bg-dark text-light border-warning mb-4">
    <div class="card-header bg-warning text-dark">
      <h5 class="mb-0"><i class="fa-solid fa-user-doctor me-2"></i>Bio-savants & Points d'√©tude</h5>
    </div>
    <div class="card-body">
      <% if @bio_savants.any? %>
        <div class="table-responsive">
          <table class="table table-dark table-hover">
            <thead>
              <tr>
                <th>Bio-savant</th>
                <th>Points d'√©tude</th>
                <th>Embryons</th>
                <th>En gestation</th>
                <th>G√®nes d√©bloqu√©s</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <% @bio_savants.each do |user| %>
                <tr>
                  <td><strong><%= user.username %></strong></td>
                  <td>
                    <span class="badge bg-warning text-dark fs-6">
                      <i class="fa-solid fa-graduation-cap me-1"></i><%= user.study_points || 0 %>
                    </span>
                  </td>
                  <td><span class="badge bg-info"><%= user.embryos.count %></span></td>
                  <td><span class="badge bg-primary"><%= user.embryos.in_gestation.count %></span></td>
                  <td><span class="badge bg-success"><%= user.user_genes.count %></span></td>
                  <td>
                    <%= form_with url: attribution_study_points_path, method: :post, local: true, class: "d-flex gap-2" do |f| %>
                      <%= f.hidden_field :user_id, value: user.id %>
                      <div class="input-group input-group-sm" style="width: 150px;">
                        <%= f.number_field :study_points, value: 1, min: 1, max: 100, class: "form-control form-control-sm" %>
                        <button type="submit" class="btn btn-warning btn-sm">
                          <i class="fa-solid fa-plus"></i>
                        </button>
                      </div>
                    <% end %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      <% else %>
        <p class="text-muted text-center py-4">Aucun Bio-savant dans le jeu.</p>
      <% end %>
    </div>
  </div>

  <!-- Lien retour -->
  <div class="text-center mt-4">
    <%= link_to mj_dashboard_path, class: "btn btn-outline-secondary" do %>
      <i class="fa-solid fa-arrow-left me-2"></i>Retour au Dashboard MJ
    <% end %>
  </div>
</div>

