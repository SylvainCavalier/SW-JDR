<div id="donner-objet-container" class="frame-container" style="position: relative; width: 100%; height: 100vh;">
  <div class="container mt-4" style="max-width: 600px;">
    <h2 class="text-center" style="color: white;">Donner Objet à un Joueur</h2>

    <%= form_with url: update_objet_path, method: :post, local: false, class: "donner-objet-form", 
          data: { 
            controller: "give-item", 
            action: "submit->give-item#submit",
            "give-item-objects-value": @objects.to_json 
          } do %>
      
      <!-- Sélection du joueur -->
      <div class="select-container mb-3">
        <%= select_tag "user_id", 
          options_for_select(@users.map { |user| [user.username, user.id] }, prompt: "Sélectionner un joueur"), 
          class: "form-select form-select-sm donner-joueur", 
          data: { action: "change->give-item#selectPlayer", "give-item-target": "playerSelect" } %>
      </div>

      <!-- Filtre des catégories -->
      <div class="select-container mb-3">
        <%= select_tag "category", 
          options_for_select(["Toutes les catégories"] + @categories), 
          class: "form-select form-select-sm donner-categorie", 
          data: { action: "change->give-item#filterObjects", "give-item-target": "categorySelect" } %>
      </div>

      <!-- Filtre des objets -->
      <div class="select-container mb-3">
        <%= select_tag "object_id", 
          options_for_select(@objects.map { |object| [object[:name], object[:id]] }), 
          class: "form-select form-select-sm donner-objet", 
          data: { "give-item-target": "objectSelect" } %>
      </div>

      <!-- Champ pour la quantité -->
      <div class="mb-3">
        <%= number_field_tag "quantity", 1, 
          class: "form-control form-control-sm donner-quantite", 
          min: 1, 
          style: "width: 100px;", 
          data: { "give-item-target": "quantityInput" } %>
      </div>

      <!-- Zone pour les messages -->
      <div data-give-item-target="message" class="alert alert-info d-none" role="alert"></div>

      <!-- Bouton de validation -->
      <div class="text-center">
        <%= submit_tag "Donner", 
          class: "btn btn-outline-success btn-sm p-0" %>
      </div>
    <% end %>

    <!-- Zone d'affichage des messages -->
    <div class="mt-3">
      <p data-give-item-target="message" class="alert" style="display: none;"></p>
    </div>

    <!-- Bouton pour créer un nouvel objet -->
    <div class="text-center mt-4">
      <button type="button" class="btn btn-outline-warning btn-sm" data-bs-toggle="modal" data-bs-target="#createObjectModal">
        <i class="fas fa-plus-circle"></i> Créer un nouvel objet
      </button>
    </div>

    <div class="text-center mt-3">
      <%= link_to "Retour", current_user.group.name == "MJ" ? mj_dashboard_path : root_path, class: "btn btn-outline-success" %>
    </div>
  </div>
</div>

<!-- Modal de création d'objet -->
<div class="modal fade" id="createObjectModal" tabindex="-1" aria-labelledby="createObjectModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" style="background-color: #1a1a2e; border: 1px solid #ffc107;">
      <div class="modal-header border-bottom border-warning">
        <h5 class="modal-title text-warning" id="createObjectModalLabel">
          <i class="fas fa-plus-circle"></i> Créer un nouvel objet
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fermer"></button>
      </div>
      
      <%= form_with url: mj_create_inventory_object_path, method: :post, local: true do |f| %>
        <div class="modal-body">
          <!-- Nom de l'objet -->
          <div class="mb-3">
            <label for="inventory_object_name" class="form-label text-light">Nom de l'objet *</label>
            <%= text_field_tag "inventory_object[name]", nil, 
                class: "form-control form-control-sm", 
                id: "inventory_object_name",
                placeholder: "Ex: Épée laser custom",
                required: true %>
          </div>

          <!-- Catégorie -->
          <div class="mb-3">
            <label for="inventory_object_category" class="form-label text-light">Catégorie *</label>
            <div class="input-group">
              <%= select_tag "inventory_object[category]", 
                  options_for_select(@categories.map { |c| [c.capitalize, c] }),
                  class: "form-select form-select-sm",
                  id: "inventory_object_category_select",
                  data: { action: "change->create-object#toggleCustomCategory" } %>
            </div>
            <div class="mt-2">
              <small class="text-muted">Ou créer une nouvelle catégorie :</small>
              <%= text_field_tag "inventory_object[custom_category]", nil,
                  class: "form-control form-control-sm mt-1",
                  id: "inventory_object_custom_category",
                  placeholder: "Nouvelle catégorie..." %>
            </div>
          </div>

          <!-- Prix -->
          <div class="mb-3">
            <label for="inventory_object_price" class="form-label text-light">Prix (crédits) *</label>
            <%= number_field_tag "inventory_object[price]", 0,
                class: "form-control form-control-sm",
                id: "inventory_object_price",
                min: 0,
                required: true %>
          </div>

          <!-- Rareté -->
          <div class="mb-3">
            <label for="inventory_object_rarity" class="form-label text-light">Rareté *</label>
            <%= select_tag "inventory_object[rarity]",
                options_for_select(@rarities),
                class: "form-select form-select-sm",
                id: "inventory_object_rarity",
                required: true %>
          </div>

          <!-- Description -->
          <div class="mb-3">
            <label for="inventory_object_description" class="form-label text-light">Description</label>
            <%= text_area_tag "inventory_object[description]", nil,
                class: "form-control form-control-sm",
                id: "inventory_object_description",
                rows: 3,
                placeholder: "Description de l'objet et de ses effets..." %>
          </div>
        </div>

        <div class="modal-footer border-top border-warning">
          <button type="button" class="btn btn-outline-secondary btn-sm" data-bs-dismiss="modal">Annuler</button>
          <%= submit_tag "Créer l'objet", class: "btn btn-warning btn-sm" %>
        </div>
      <% end %>
    </div>
  </div>
</div>